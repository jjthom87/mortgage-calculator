<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Mortgage Calculation</title>
  </head>
  <body>
    <div class="container">
      <h1>Mortgage Calculation</h1>
      <div class="form-div">
        <form id="mortgage-calculation-form">
          <label for="loanAmount">Loan Amount</label><br>
          <input type="number" id="loanAmount"><br>
          <label for="interestRate">Interest Rate</label><br>
          <input type="number" step="0.01" id="interestRate"><br>
          <label for="extraPayment">Extra Payment</label><br>
          <input type="checkbox" id="extraPayment"><br>
          <input type="submit"value="Calculate">
        </form>
      </div>
      <div class="table-div">

      </div>
    </div>
  </body>
  <script type="text/javascript">
    const totalMortgagePayment = (loanAmount, interestRate) => {
        let lengthOfMortgageInYears = 30;
        let yearlyPayments = 12;
        let lengthOfMortgageInMonths = lengthOfMortgageInYears * yearlyPayments
        const interestPercentage = interestRate/100;
        const monthlyInterestRate = interestPercentage/12;
        let monthlyRate = Math.pow((1+monthlyInterestRate), lengthOfMortgageInMonths);
        monthlyRate = (monthlyInterestRate * (monthlyRate))/(monthlyRate-1);
        const monthlyPayment = loanAmount * monthlyRate;

        return monthlyPayment;
    }

    const calculateAmortization = (loanAmount, interestRate, extraYearlyPayment) => {
      const interestPercentage = interestRate/100;
      const monthlyPayment = totalMortgagePayment(loanAmount, interestRate);
      let principalBalance = loanAmount
      let paymentNumber = 0;
      let months = 360;
      let tableHTML = "";

      while(principalBalance > 0){
        let interest = monthlyPayment - (principalBalance * interestPercentage)/12;
        months--;
        if(extraYearlyPayment && months % 12 == 0){
          principalBalance = principalBalance - interest;
          principalBalance = principalBalance - monthlyPayment;
        } else {
          principalBalance = principalBalance - interest;
        }
        paymentNumber++;
        principalBalance = principalBalance < 0 ? 0 : principalBalance;
        tableHTML += "<tr><td>" + paymentNumber + "</td><td>" + principalBalance + "</td></tr>"
      }

      return tableHTML;
    }

    document.querySelector("#mortgage-calculation-form").addEventListener("submit", function(e){
      e.preventDefault();
      document.querySelector(".table-div").innerHTML = "";

      let tableHTML = "";
      tableHTML += "<table><tr><th>Payment #</th><th>Principal Balance</th><tr>";
      tableHTML += calculateAmortization(document.querySelector("#loanAmount").value, document.querySelector("#interestRate").value, document.querySelector("#extraPayment").checked)
      tableHTML += "</table>";

      document.querySelector(".table-div").innerHTML = tableHTML;
    });
  </script>
</html>
